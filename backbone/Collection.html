<!DOCTYPE html>
<html>
<head>

  <meta charset="utf-8"/>
  <script src="jquery.js"></script>
  <script src="underscore.js"></script>
  <script src="backbone.js"></script>

<script>
$(document).ready(function(){

var Todo = Backbone.Model.extend({

  defaults : {
    title: '',
	completed: false
  }
  
});

var TodosCollection = Backbone.Collection.extend({
  model: Todo  // collection of Todo models
});


var todo1 = new Todo();
todo1.set("title", "todo1 title");

var todo2 = new Todo();
todo2.set("title", "todo2 title");

var todo3 = new Todo();
todo3.set("title", "todo3 title");

// pass array of models on collection instantiation
var todos = new TodosCollection( [todo1] );
console.log("Collection size: " + todos.length); // Collection size: 1

todos.add( todo2 );
todos.add( todo3 );
console.log("Collection size: " + todos.length); // Collection size: 3

todos.remove( todo1 );
console.log("Collection size: " + todos.length); // Collection size: 2

// retrieving models from collection
// In client server applications models uniquely identified by id, cid, idAttribute properties
// each model has : an id that is either integer or string
//                : a cid(Client id) - automatically generated by backbone when model is created
//                Either identifier can be used to retrieve a model from a collection
//                : idAttribute is the identifying attribute of the model returned from the server (i.e., the id in your database).
//                  Tells backbone which data field from the server should be used to populate the id property (think of mapping)
//                  Assumes attribute is id but can be customnized
//                  For instance, if your server sets a unique attribute on your model named "userId" then you would set
//                  idAttribute to "userId" in model definition
//                  The value of a model's idAttribute should be set by the server when the model is saved
//
// Internally, Backbone.Collection contains an array of models enumerated by their id property, if the model instances happen to have one
// when collection.get(id) is called, this array is checked for existence of the model instance with the corresponding id
// extend previous example : 
  
console.log('todo1 cid = ' + todo1.cid);  // cid generated by backbone

var MyTodo = Backbone.Model.extend({

  defaults : {
    title: 'Retrieved title',
	completed: false,
	id: 0
  }
  
});
var myTodo1 = new MyTodo();
console.log(JSON.stringify(myTodo1));
console.log('mytodo1 default id = ' + myTodo1.id);  // id = 0
console.log('myTodo1 title = ' + myTodo1.get("title") );
myTodo1.set("id", 1);
console.log('mytodo1 new id = ' + myTodo1.id);  // id = 1

var MyTodoCollection = Backbone.Collection.extend({
  model: MyTodo  // collection of MyTodo models
});

var myTodos = new MyTodoCollection( [myTodo1] );  // generate cid value?
// retrieve myTodo1 from collection
var retrievedTodo = myTodos.get(1);  // get based on id
console.log('title: ' + retrievedTodo.get("title") );

// can listen for add, remove and change events on collection instance
myTodos.on('add', function(x) {
                    console.log('new entry added to collection');
                  }
	      );
myTodos.on('remove', function(x) {
                    console.log('entry removed from collection');
                  }
	      );
myTodos.on('change', function(x) {
                    console.log('collection entry changed');
                  }
	      );
var myTodo2 = new MyTodo();
myTodos.add(myTodo2);
myTodos.remove(myTodo2);
myTodos.add(myTodo2);
myTodo2.set('title','changed title');  // doesn't work. reference required from collection
var ModelRefFromCollection = myTodos.get(0);
ModelRefFromCollection.set('title','changed title');

// resetting/refreshing collections
var LastTodo = Backbone.Model.extend({

  defaults : {
    title: '',
	completed: false
  }
});
var LastTodoCollection = Backbone.Collection.extend({
  model: LastTodo  // collection of LastTodo models
});
// create models
var LastTodo1 = new LastTodo();
LastTodo1.set("title", "Last todo1 title");
var LastTodo2 = new LastTodo();
LastTodo2.set("title", "Last todo2 title");
// create collection
var LastTodos = new LastTodoCollection( [LastTodo1] );
LastTodos.on("reset", function() {
                        console.log('collection reset');
                      });
LastTodos.add(LastTodo2);
console.log('elements in last collection: ' + LastTodos.length);
LastTodos.reset();
console.log('elements in last collection: ' + LastTodos.length);
LastTodos.reset( [{title: 'reset title'}] );
console.log('elements in last collection: ' + LastTodos.length);





});
</script>

</head>

<body>


  
</body>
</html>